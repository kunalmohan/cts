{"version":3,"sources":["../../../src/framework/util/stack.ts"],"names":["getStackTrace","e","stack","parts","split","moreStack","found","suitesRegex","i","length","part","trim","isSuites","test","push","join"],"mappings":";;;;AAAA;AACA;AACA;AACA,OAAO,SAASA,aAAT,CAAuBC,CAAvB,EAAyC;AAC9C,MAAI,CAACA,CAAC,CAACC,KAAP,EAAc;AACZ,WAAO,EAAP;AACD;;AAED,QAAMC,KAAK,GAAGF,CAAC,CAACC,KAAF,CAAQE,KAAR,CAAc,IAAd,CAAd;AAEA,QAAMF,KAAK,GAAG,EAAd;AACA,QAAMG,SAAS,GAAG,EAAlB;AACA,MAAIC,KAAK,GAAG,KAAZ;AACA,QAAMC,WAAW,GAAG,oBAApB;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,KAAK,CAACM,MAA1B,EAAkC,EAAED,CAApC,EAAuC;AACrC,UAAME,IAAI,GAAGP,KAAK,CAACK,CAAD,CAAL,CAASG,IAAT,EAAb;AACA,UAAMC,QAAQ,GAAGL,WAAW,CAACM,IAAZ,CAAiBH,IAAjB,CAAjB;;AACA,QAAIJ,KAAK,IAAI,CAACM,QAAd,EAAwB;AACtBP,MAAAA,SAAS,CAACS,IAAV,CAAeJ,IAAf;AACD;;AACD,QAAIE,QAAJ,EAAc;AACZ,UAAIP,SAAS,CAACI,MAAd,EAAsB;AACpBP,QAAAA,KAAK,CAACY,IAAN,CAAW,GAAGT,SAAd;AACAA,QAAAA,SAAS,CAACI,MAAV,GAAmB,CAAnB;AACD;;AACDP,MAAAA,KAAK,CAACY,IAAN,CAAWJ,IAAX;AACAJ,MAAAA,KAAK,GAAG,IAAR;AACD;AACF;;AACD,SAAOJ,KAAK,CAACa,IAAN,CAAW,IAAX,CAAP;AACD,C,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["// Takes a stack trace, and extracts only the first continuous range of lines\n// containing '/suites/', which should provide only the useful part of the stack\n// to the caller (for logging).\nexport function getStackTrace(e: Error): string {\n  if (!e.stack) {\n    return '';\n  }\n\n  const parts = e.stack.split('\\n');\n\n  const stack = [];\n  const moreStack = [];\n  let found = false;\n  const suitesRegex = /[\\/\\\\]suites[\\/\\\\]/;\n  for (let i = 0; i < parts.length; ++i) {\n    const part = parts[i].trim();\n    const isSuites = suitesRegex.test(part);\n    if (found && !isSuites) {\n      moreStack.push(part);\n    }\n    if (isSuites) {\n      if (moreStack.length) {\n        stack.push(...moreStack);\n        moreStack.length = 0;\n      }\n      stack.push(part);\n      found = true;\n    }\n  }\n  return stack.join('\\n');\n}\n\n// *** Examples ***\n//\n// Node fail()\n// > Error:\n// >    at CaseRecorder.fail (/Users/kainino/src/cts-experiment/src/framework/logger.ts:99:30)\n// >    at RunCaseSpecific.exports.g.test.t [as fn] (/Users/kainino/src/cts-experiment/src/suites/unittests/logger.spec.ts:80:7)\n// x    at RunCaseSpecific.run (/Users/kainino/src/cts-experiment/src/framework/test_group.ts:121:18)\n// x    at processTicksAndRejections (internal/process/task_queues.js:86:5)\n//\n// Node throw\n// > Error: hello\n// >     at RunCaseSpecific.g.test.t [as fn] (/Users/kainino/src/cts-experiment/src/suites/unittests/test_group.spec.ts:51:11)\n// x     at RunCaseSpecific.run (/Users/kainino/src/cts-experiment/src/framework/test_group.ts:121:18)\n// x     at processTicksAndRejections (internal/process/task_queues.js:86:5)\n//\n// Firefox fail()\n// > fail@http://localhost:8080/out/framework/logger.js:104:30\n// > expect@http://localhost:8080/out/framework/default_fixture.js:59:16\n// > @http://localhost:8080/out/suites/unittests/util.spec.js:35:5\n// x run@http://localhost:8080/out/framework/test_group.js:119:18\n//\n// Firefox throw\n// > @http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11\n// x run@http://localhost:8080/out/framework/test_group.js:119:18\n//\n// Safari fail()\n// > fail@http://localhost:8080/out/framework/logger.js:104:39\n// > expect@http://localhost:8080/out/framework/default_fixture.js:59:20\n// > http://localhost:8080/out/suites/unittests/util.spec.js:35:11\n// x http://localhost:8080/out/framework/test_group.js:119:20\n// x asyncFunctionResume@[native code]\n// x [native code]\n// x promiseReactionJob@[native code]\n//\n// Safari throw\n// > http://localhost:8080/out/suites/unittests/test_group.spec.js:48:20\n// x http://localhost:8080/out/framework/test_group.js:119:20\n// x asyncFunctionResume@[native code]\n// x [native code]\n// x promiseReactionJob@[native code]\n//\n// Chrome fail()\n// x Error\n// x     at CaseRecorder.fail (http://localhost:8080/out/framework/logger.js:104:30)\n// x     at DefaultFixture.expect (http://localhost:8080/out/framework/default_fixture.js:59:16)\n// >     at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/util.spec.js:35:5)\n// x     at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\n// x     at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n// x     at async http://localhost:8080/out/runtime/standalone.js:102:7\n//\n// Chrome throw\n// x Error: hello\n// >     at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n// x     at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\"\n// x     at async Promise.all (index 0)\n// x     at async TestGroupTest.run (http://localhost:8080/out/suites/unittests/test_group_test.js:6:5)\n// x     at async RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:53:15)\n// x     at async RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:7)\n// x     at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n// x     at async http://localhost:8080/out/runtime/standalone.js:102:7\n"],"file":"stack.js"}
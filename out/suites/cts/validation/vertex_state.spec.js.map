{"version":3,"sources":["../../../../src/suites/cts/validation/vertex_state.spec.ts"],"names":["description","C","TestGroup","ValidationTest","MAX_VERTEX_ATTRIBUTES","MAX_VERTEX_BUFFER_END","MAX_VERTEX_BUFFER_ARRAY_STRIDE","MAX_VERTEX_BUFFERS","SIZEOF_FLOAT","Float32Array","BYTES_PER_ELEMENT","VERTEX_SHADER_CODE_WITH_NO_INPUT","clone","descriptor","JSON","parse","stringify","F","init","Promise","all","initGLSL","getDescriptor","vertexState","vertexShaderCode","vertexStage","getVertexStage","fragmentStage","getFragmentStage","layout","getPipelineLayout","primitiveTopology","colorStates","format","code","module","makeShaderModuleFromGLSL","entryPoint","device","createPipelineLayout","bindGroupLayouts","g","test","t","createRenderPipeline","vertexBuffers","arrayStride","attributes","offset","shaderLocation","expectValidationError","VertexFormat","Float","badVertexState","Float2","goodVertexState","Int2","i","push","vertexAttributes","Uchar2","Number","MAX_SAFE_INTEGER"],"mappings":";;;;AAAA,OAAO,MAAMA,WAAW,GAAI;;CAArB;AAIP,SAASC,CAAT,EAAYC,SAAZ,QAA6B,6BAA7B;AAEA,SAASC,cAAT,QAA+B,sBAA/B;AAEA,MAAMC,qBAA6B,GAAG,EAAtC;AACA,MAAMC,qBAA6B,GAAG,IAAtC;AACA,MAAMC,8BAAsC,GAAG,IAA/C;AACA,MAAMC,kBAA0B,GAAG,EAAnC;AAEA,MAAMC,YAAY,GAAGC,YAAY,CAACC,iBAAlC;AAEA,MAAMC,gCAAgC,GAAI;;;;;CAA1C;;AAOA,SAASC,KAAT,CAAmDC,UAAnD,EAAqE;AACnE,SAAOC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeH,UAAf,CAAX,CAAP;AACD;;AAED,MAAMI,CAAN,SAAgBd,cAAhB,CAA+B;AAC7B,QAAMe,IAAN,GAA4B;AAC1B,UAAMC,OAAO,CAACC,GAAR,CAAY,CAAC,MAAMF,IAAN,EAAD,EAAe,KAAKG,QAAL,EAAf,CAAZ,CAAN;AACD;;AAEDC,EAAAA,aAAa,CACXC,WADW,EAEXC,gBAFW,EAGkB;AAC7B,UAAMX,UAAuC,GAAG;AAC9CY,MAAAA,WAAW,EAAE,KAAKC,cAAL,CAAoBF,gBAApB,CADiC;AAE9CG,MAAAA,aAAa,EAAE,KAAKC,gBAAL,EAF+B;AAG9CC,MAAAA,MAAM,EAAE,KAAKC,iBAAL,EAHsC;AAI9CC,MAAAA,iBAAiB,EAAE,eAJ2B;AAK9CC,MAAAA,WAAW,EAAE,CAAC;AAAEC,QAAAA,MAAM,EAAE;AAAV,OAAD,CALiC;AAM9CV,MAAAA;AAN8C,KAAhD;AAQA,WAAOV,UAAP;AACD;;AAEDa,EAAAA,cAAc,CAACQ,IAAD,EAA+C;AAC3D,WAAO;AACLC,MAAAA,MAAM,EAAE,KAAKC,wBAAL,CAA8B,QAA9B,EAAwCF,IAAxC,CADH;AAELG,MAAAA,UAAU,EAAE;AAFP,KAAP;AAID;;AAEDT,EAAAA,gBAAgB,GAAmC;AACjD,UAAMM,IAAI,GAAI;;;;;;KAAd;AAOA,WAAO;AACLC,MAAAA,MAAM,EAAE,KAAKC,wBAAL,CAA8B,UAA9B,EAA0CF,IAA1C,CADH;AAELG,MAAAA,UAAU,EAAE;AAFP,KAAP;AAID;;AAEDP,EAAAA,iBAAiB,GAAsB;AACrC,WAAO,KAAKQ,MAAL,CAAYC,oBAAZ,CAAiC;AAAEC,MAAAA,gBAAgB,EAAE;AAApB,KAAjC,CAAP;AACD;;AA3C4B;;AA8C/B,OAAO,MAAMC,CAAC,GAAG,IAAIvC,SAAJ,CAAce,CAAd,CAAV;AAEPwB,CAAC,CAACC,IAAF,CAAO,gCAAP,EAAyCC,CAAC,IAAI;AAC5C,QAAMpB,WAAqC,GAAG,EAA9C;AACA,QAAMV,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,EAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,CAJD;AAMA4B,CAAC,CAACC,IAAF,CAAO,wBAAP,EAAiCC,CAAC,IAAI;AACpC;AACE;AACA,UAAMpB,WAAqC,GAAG;AAC5CsB,MAAAA,aAAa,EAAE,CACb;AACEC,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE;AAFd,OADa;AAD6B,KAA9C;AAQA,UAAMlC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACA,UAAMU,WAAqC,GAAG;AAC5CsB,MAAAA,aAAa,EAAE,CACb;AACEC,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE;AAFd,OADa,EAKb;AACED,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE,CACV;AACEd,UAAAA,MAAM,EAAE,OADV;AAEEe,UAAAA,MAAM,EAAE,CAFV;AAGEC,UAAAA,cAAc,EAAE;AAHlB,SADU;AAFd,OALa;AAD6B,KAA9C;AAkBA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACA,UAAMU,WAAqC,GAAG;AAC5CsB,MAAAA,aAAa,EAAE,CACb;AACEC,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE,CACV;AACEd,UAAAA,MAAM,EAAE,OADV;AAEEe,UAAAA,MAAM,EAAE,CAFV;AAGEC,UAAAA,cAAc,EAAE;AAHlB,SADU;AAFd,OADa,EAWb;AACEH,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE;AAFd,OAXa,EAeb;AACED,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE,CACV;AACEd,UAAAA,MAAM,EAAE,OADV;AAEEe,UAAAA,MAAM,EAAE,CAFV;AAGEC,UAAAA,cAAc,EAAE;AAHlB,SADU;AAFd,OAfa;AAD6B,KAA9C;AA4BA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACF,CAtED;AAwEA4B,CAAC,CAACC,IAAF,CAAO,kEAAP,EAA2E,MAAMC,CAAN,IAAW;AACpF,QAAMpB,WAAqC,GAAG;AAC5CsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,IAAItC,YADnB;AAEEuC,MAAAA,UAAU,EAAE,CACV;AACEd,QAAAA,MAAM,EAAE,OADV;AAEEe,QAAAA,MAAM,EAAE,CAFV;AAGEC,QAAAA,cAAc,EAAE;AAHlB,OADU,EAMV;AACEhB,QAAAA,MAAM,EAAE,OADV;AAEEe,QAAAA,MAAM,EAAE,CAFV;AAGEC,QAAAA,cAAc,EAAE;AAHlB,OANU;AAFd,KADa;AAD6B,GAA9C;AAmBA;AACE;AACA,UAAMf,IAAI,GAAI;;;;;;;KAAd;AAQA,UAAMrB,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BW,IAA7B,CAAnB;AACAS,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACA,UAAMqB,IAAI,GAAI;;;;;;KAAd;AAOA,UAAMrB,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BW,IAA7B,CAAnB;AACAS,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACA,UAAMqB,IAAI,GAAI;;;;;;KAAd;AAOA,UAAMrB,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BW,IAA7B,CAAnB;AAEAS,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CA5DD;AA8DA4B,CAAC,CAACC,IAAF,CAAO,8BAAP,EAAuCC,CAAC,IAAI;AAC1C,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,CADf;AAEEC,MAAAA,UAAU,EAAE,CACV;AACEd,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KADzB;AAEEJ,QAAAA,MAAM,EAAE,CAFV;AAGEC,QAAAA,cAAc,EAAE;AAHlB,OADU;AAFd,KADa;AADG,GAApB;AAcA;AACE;AACA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2CC,MAA3C,GAAoD,GAApD;AACA,UAAMnC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACF,CA1BD;AA4BA4B,CAAC,CAACC,IAAF,CAAO,8EAAP,EAAuF,MAAMC,CAAN,IAAW;AAChG,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,IAAItC,YADnB;AAEEuC,MAAAA,UAAU,EAAE,CACV;AACEd,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KADzB;AAEEJ,QAAAA,MAAM,EAAE,CAFV;AAGEC,QAAAA,cAAc,EAAE;AAHlB,OADU,EAMV;AACEhB,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KADzB;AAEEJ,QAAAA,MAAM,EAAExC,YAFV;AAGEyC,QAAAA,cAAc,EAAE;AAHlB,OANU;AAFd,KADa;AADG,GAApB;AAmBA;AACE;AACA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACA,UAAMwC,cAAc,GAAGzC,KAAK,CAACW,WAAD,CAA5B;AACA8B,IAAAA,cAAc,CAACR,aAAf,CAA6B,CAA7B,EAAgCE,UAAhC,CAA2C,CAA3C,EAA8Cd,MAA9C,GAAuDhC,CAAC,CAACkD,YAAF,CAAeG,MAAtE;AACA,UAAMzC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgB+B,cAAhB,EAAgC1C,gCAAhC,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACD;AACE;AACA,UAAMwC,cAAc,GAAGzC,KAAK,CAACW,WAAD,CAA5B;AACA8B,IAAAA,cAAc,CAACR,aAAf,CAA6B,CAA7B,EAAgCC,WAAhC,GAA8CtC,YAA9C;AACA,UAAMK,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgB+B,cAAhB,EAAgC1C,gCAAhC,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACD;AACE;AACA,UAAM0C,eAAe,GAAG3C,KAAK,CAACW,WAAD,CAA7B;AACAgC,IAAAA,eAAe,CAACV,aAAhB,CAA8B,CAA9B,EAAiCC,WAAjC,GAA+C,CAA/C;AACA,UAAMjC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBiC,eAAhB,EAAiC5C,gCAAjC,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACF,CApDD;AAsDA4B,CAAC,CAACC,IAAF,CAAO,kCAAP,EAA2C,MAAMC,CAAN,IAAW;AACpD,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,IAAItC,YADnB;AAEEuC,MAAAA,UAAU,EAAE,CACV;AACEd,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KADzB;AAEEJ,QAAAA,MAAM,EAAE,CAFV;AAGEC,QAAAA,cAAc,EAAE;AAHlB,OADU,EAMV;AACEhB,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KADzB;AAEEJ,QAAAA,MAAM,EAAExC,YAFV;AAGEyC,QAAAA,cAAc,EAAE;AAHlB,OANU;AAFd,KADa;AADG,GAApB;AAmBA;AACE;AACA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACA,UAAMwC,cAAc,GAAGzC,KAAK,CAACW,WAAD,CAA5B;AACA8B,IAAAA,cAAc,CAACR,aAAf,CAA6B,CAA7B,EAAgCE,UAAhC,CAA2C,CAA3C,EAA8Cd,MAA9C,GAAuDhC,CAAC,CAACkD,YAAF,CAAeK,IAAtE;AACA,UAAM3C,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgB+B,cAAhB,EAAgC1C,gCAAhC,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CAnCD;AAqCA4B,CAAC,CAACC,IAAF,CAAO,iEAAP,EAA0E,MAAMC,CAAN,IAAW;AACnF,QAAME,aAAgD,GAAG,EAAzD;;AAEA,OAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlD,kBAApB,EAAwCkD,CAAC,EAAzC,EAA6C;AAC3CZ,IAAAA,aAAa,CAACa,IAAd,CAAmB;AACjBZ,MAAAA,WAAW,EAAE,CADI;AAEjBC,MAAAA,UAAU,EAAE,CACV;AACEd,QAAAA,MAAM,EAAE,OADV;AAEEe,QAAAA,MAAM,EAAE,CAFV;AAGEC,QAAAA,cAAc,EAAEQ;AAHlB,OADU;AAFK,KAAnB;AAUD;;AACD;AACE;AACA,UAAMlC,WAAqC,GAAG;AAAEsB,MAAAA;AAAF,KAA9C;AACA,UAAMhC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACA,UAAMU,WAAqC,GAAG;AAC5CsB,MAAAA,aAAa,EAAE,CACb,GAAGA,aADU,EAEb;AACEC,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE,CACV;AACEd,UAAAA,MAAM,EAAE,OADV;AAEEe,UAAAA,MAAM,EAAE,CAFV;AAGEC,UAAAA,cAAc,EAAE1C;AAHlB,SADU;AAFd,OAFa;AAD6B,KAA9C;AAeA,UAAMM,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CA5CD;AA8CA4B,CAAC,CAACC,IAAF,CAAO,8EAAP,EAAuF,MAAMC,CAAN,IAAW;AAChG,QAAMgB,gBAAgD,GAAG,EAAzD;;AAEA,OAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrD,qBAApB,EAA2CqD,CAAC,EAA5C,EAAgD;AAC9CE,IAAAA,gBAAgB,CAACD,IAAjB,CAAsB;AACpBzB,MAAAA,MAAM,EAAE,OADY;AAEpBe,MAAAA,MAAM,EAAE,CAFY;AAGpBC,MAAAA,cAAc,EAAEQ;AAHI,KAAtB;AAKD;;AACD;AACE;AACA,UAAMlC,WAAqC,GAAG;AAC5CsB,MAAAA,aAAa,EAAE,CACb;AACEC,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAEY;AAFd,OADa;AAD6B,KAA9C;AAQA,UAAM9C,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACA,UAAMU,WAAqC,GAAG;AAC5CsB,MAAAA,aAAa,EAAE,CACb;AACEC,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE,CACV,GAAGY,gBADO,EAEV;AACE1B,UAAAA,MAAM,EAAE,OADV;AAEEe,UAAAA,MAAM,EAAE,CAFV;AAGEC,UAAAA,cAAc,EAAE7C;AAHlB,SAFU;AAFd,OADa;AAD6B,KAA9C;AAeA,UAAMS,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CA9CD;AAgDA4B,CAAC,CAACC,IAAF,CAAO,0EAAP,EAAmF,MAAMC,CAAN,IAAW;AAC5F,QAAME,aAAgD,GAAG,EAAzD;;AACA,OAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrD,qBAApB,EAA2CqD,CAAC,EAA5C,EAAgD;AAC9CZ,IAAAA,aAAa,CAACa,IAAd,CAAmB;AACjBZ,MAAAA,WAAW,EAAE,CADI;AAEjBC,MAAAA,UAAU,EAAE,CAAC;AAAEd,QAAAA,MAAM,EAAE,OAAV;AAAmBe,QAAAA,MAAM,EAAE,CAA3B;AAA8BC,QAAAA,cAAc,EAAEQ;AAA9C,OAAD;AAFK,KAAnB;AAID;;AAED;AACE;AACA,UAAMlC,WAAqC,GAAG;AAAEsB,MAAAA;AAAF,KAA9C;AACA,UAAMhC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAgC,IAAAA,aAAa,CAACzC,qBAAqB,GAAG,CAAzB,CAAb,CAAyC2C,UAAzC,CAAoDW,IAApD,CAAyD;AACvDzB,MAAAA,MAAM,EAAE,OAD+C;AAEvDe,MAAAA,MAAM,EAAE,CAF+C;AAGvDC,MAAAA,cAAc,EAAE7C;AAHuC,KAAzD;AAKA,UAAMmB,WAAqC,GAAG;AAAEsB,MAAAA;AAAF,KAA9C;AACA,UAAMhC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CA7BD;AA+BA4B,CAAC,CAACC,IAAF,CAAO,gDAAP,EAAyD,MAAMC,CAAN,IAAW;AAClE,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CAAC;AAAEC,MAAAA,WAAW,EAAExC,8BAAf;AAA+CyC,MAAAA,UAAU,EAAE;AAA3D,KAAD;AADG,GAApB;AAGA;AACE;AACA,UAAMlC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BC,WAA7B,GAA2CxC,8BAA8B,GAAG,CAA5E;AACA,UAAMO,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CAlBD;AAoBA4B,CAAC,CAACC,IAAF,CAAO,2DAAP,EAAoE,MAAMC,CAAN,IAAW;AAC7E,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,CADf;AAEEC,MAAAA,UAAU,EAAE,CAAC;AAAEd,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeS,MAAzB;AAAiCZ,QAAAA,MAAM,EAAE,CAAzC;AAA4CC,QAAAA,cAAc,EAAE;AAA5D,OAAD;AAFd,KADa;AADG,GAApB;AAQA;AACE;AACA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BC,WAA7B,GAA2C,CAA3C;AACA,UAAMjC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CAvBD;AAyBA4B,CAAC,CAACC,IAAF,CAAO,4CAAP,EAAqD,MAAMC,CAAN,IAAW;AAC9D,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,CADf;AAEEC,MAAAA,UAAU,EAAE,CAAC;AAAEd,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KAAzB;AAAgCJ,QAAAA,MAAM,EAAE,CAAxC;AAA2CC,QAAAA,cAAc,EAAE;AAA3D,OAAD;AAFd,KADa;AADG,GAApB;AAQA;AACE;AACA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwCW,IAAxC,CAA6C;AAC3CzB,MAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KADoB;AAE3CJ,MAAAA,MAAM,EAAE,CAFmC;AAG3CC,MAAAA,cAAc,EAAE;AAH2B,KAA7C;AAKA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CA3BD;AA6BA4B,CAAC,CAACC,IAAF,CAAO,oCAAP,EAA6C,MAAMC,CAAN,IAAW;AACtD;AACE,UAAMpB,WAAW,GAAG;AAClBsB,MAAAA,aAAa,EAAE,CACb;AACEC,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE,CACV;AAAEd,UAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KAAzB;AAAgCJ,UAAAA,MAAM,EAAE,CAAxC;AAA2CC,UAAAA,cAAc,EAAE;AAA3D,SADU,EAEV;AAAEhB,UAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KAAzB;AAAgCJ,UAAAA,MAAM,EAAExC,YAAxC;AAAsDyC,UAAAA,cAAc,EAAE;AAAtE,SAFU;AAFd,OADa;AADG,KAApB;AAWA;AACE;AACA,YAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,MAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2CE,cAA3C,GAA4D,CAA5D;AACA,YAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,MAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,QAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,OAFD;AAGD;AACF;AACD;AACE,UAAMU,WAAqC,GAAG;AAC5CsB,MAAAA,aAAa,EAAE,CACb;AACEC,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE,CACV;AACEd,UAAAA,MAAM,EAAE,OADV;AAEEe,UAAAA,MAAM,EAAE,CAFV;AAGEC,UAAAA,cAAc,EAAE;AAHlB,SADU;AAFd,OADa,EAWb;AACEH,QAAAA,WAAW,EAAE,CADf;AAEEC,QAAAA,UAAU,EAAE,CACV;AACEd,UAAAA,MAAM,EAAE,OADV;AAEEe,UAAAA,MAAM,EAAE,CAFV;AAGEC,UAAAA,cAAc,EAAE;AAHlB,SADU;AAFd,OAXa;AAD6B,KAA9C,CADF,CAyBE;;AACA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CA5DD;AA8DA4B,CAAC,CAACC,IAAF,CAAO,4DAAP,EAAqE,MAAMC,CAAN,IAAW;AAC9E,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,CADf;AAEEC,MAAAA,UAAU,EAAE,CACV;AAAEd,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KAAzB;AAAgCJ,QAAAA,MAAM,EAAE,CAAxC;AAA2CC,QAAAA,cAAc,EAAE7C,qBAAqB,GAAG;AAAnF,OADU;AAFd,KADa;AADG,GAApB;AAUA;AACE;AACA,UAAMS,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2CE,cAA3C,GAA4D7C,qBAA5D;AACA,UAAMS,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CAzBD;AA2BA4B,CAAC,CAACC,IAAF,CAAO,sCAAP,EAA+C,MAAMC,CAAN,IAAW;AACxD,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,CADf;AAEEC,MAAAA,UAAU,EAAE,CACV;AACEd,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeG,MADzB;AAEEN,QAAAA,MAAM,EAAE3C,qBAAqB,GAAG,IAAIG,YAFtC;AAGEyC,QAAAA,cAAc,EAAE;AAHlB,OADU;AAFd,KADa;AADG,GAApB;AAcA;AACE;AACA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2CC,MAA3C,GAAoD,CAApD;AACA,UAAMnC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2CC,MAA3C,GAAoD3C,qBAAqB,GAAG,CAA5E;AACA,UAAMQ,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CAnCD;AAqCA4B,CAAC,CAACC,IAAF,CAAO,gDAAP,EAAyD,MAAMC,CAAN,IAAW;AAClE,QAAMpB,WAAW,GAAG;AAClBsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,CADf;AAEEC,MAAAA,UAAU,EAAE,CAAC;AAAEd,QAAAA,MAAM,EAAEhC,CAAC,CAACkD,YAAF,CAAeC,KAAzB;AAAgCJ,QAAAA,MAAM,EAAExC,YAAxC;AAAsDyC,QAAAA,cAAc,EAAE;AAAtE,OAAD;AAFd,KADa;AADG,GAApB;AAQA;AACE;AACA,UAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2CC,MAA3C,GAAoD,CAApD;AACAzB,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2Cd,MAA3C,GAAoDhC,CAAC,CAACkD,YAAF,CAAeS,MAAnE;AACA,UAAM/C,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AACAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACD;AACE;AACAU,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2CC,MAA3C,GAAoD,CAApD;AACAzB,IAAAA,WAAW,CAACsB,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,CAAwC,CAAxC,EAA2Cd,MAA3C,GAAoDhC,CAAC,CAACkD,YAAF,CAAeC,KAAnE;AACA,UAAMvC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,IAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,MAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,KAFD;AAGD;AACF,CAjCD;AAmCA4B,CAAC,CAACC,IAAF,CAAO,iCAAP,EAA0C,MAAMC,CAAN,IAAW;AACnD,QAAMpB,WAAqC,GAAG;AAC5CsB,IAAAA,aAAa,EAAE,CACb;AACEC,MAAAA,WAAW,EAAE,CADf;AAEEC,MAAAA,UAAU,EAAE,CAAC;AAAEd,QAAAA,MAAM,EAAE,OAAV;AAAmBe,QAAAA,MAAM,EAAEa,MAAM,CAACC,gBAAlC;AAAoDb,QAAAA,cAAc,EAAE;AAApE,OAAD;AAFd,KADa;AAD6B,GAA9C;AAQA,QAAMpC,UAAU,GAAG8B,CAAC,CAACrB,aAAF,CAAgBC,WAAhB,EAA6BZ,gCAA7B,CAAnB;AAEAgC,EAAAA,CAAC,CAACO,qBAAF,CAAwB,MAAM;AAC5BP,IAAAA,CAAC,CAACL,MAAF,CAASM,oBAAT,CAA8B/B,UAA9B;AACD,GAFD;AAGD,CAdD","sourcesContent":["export const description = `\nvertexState validation tests.\n`;\n\nimport { C, TestGroup } from '../../../framework/index.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nconst MAX_VERTEX_ATTRIBUTES: number = 16;\nconst MAX_VERTEX_BUFFER_END: number = 2048;\nconst MAX_VERTEX_BUFFER_ARRAY_STRIDE: number = 2048;\nconst MAX_VERTEX_BUFFERS: number = 16;\n\nconst SIZEOF_FLOAT = Float32Array.BYTES_PER_ELEMENT;\n\nconst VERTEX_SHADER_CODE_WITH_NO_INPUT = `\n  #version 450\n  void main() {\n    gl_Position = vec4(0.0);\n  }\n`;\n\nfunction clone<T extends GPUVertexStateDescriptor>(descriptor: T): T {\n  return JSON.parse(JSON.stringify(descriptor));\n}\n\nclass F extends ValidationTest {\n  async init(): Promise<void> {\n    await Promise.all([super.init(), this.initGLSL()]);\n  }\n\n  getDescriptor(\n    vertexState: GPUVertexStateDescriptor,\n    vertexShaderCode: string\n  ): GPURenderPipelineDescriptor {\n    const descriptor: GPURenderPipelineDescriptor = {\n      vertexStage: this.getVertexStage(vertexShaderCode),\n      fragmentStage: this.getFragmentStage(),\n      layout: this.getPipelineLayout(),\n      primitiveTopology: 'triangle-list',\n      colorStates: [{ format: 'rgba8unorm' }],\n      vertexState,\n    };\n    return descriptor;\n  }\n\n  getVertexStage(code: string): GPUProgrammableStageDescriptor {\n    return {\n      module: this.makeShaderModuleFromGLSL('vertex', code),\n      entryPoint: 'main',\n    };\n  }\n\n  getFragmentStage(): GPUProgrammableStageDescriptor {\n    const code = `\n      #version 450\n      layout(location = 0) out vec4 fragColor;\n      void main() {\n        fragColor = vec4(0.0, 1.0, 0.0, 1.0);\n      }\n    `;\n    return {\n      module: this.makeShaderModuleFromGLSL('fragment', code),\n      entryPoint: 'main',\n    };\n  }\n\n  getPipelineLayout(): GPUPipelineLayout {\n    return this.device.createPipelineLayout({ bindGroupLayouts: [] });\n  }\n}\n\nexport const g = new TestGroup(F);\n\ng.test('an empty vertex input is valid', t => {\n  const vertexState: GPUVertexStateDescriptor = {};\n  const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n  t.device.createRenderPipeline(descriptor);\n});\n\ng.test('a null buffer is valid', t => {\n  {\n    // One null buffer is OK\n    const vertexState: GPUVertexStateDescriptor = {\n      vertexBuffers: [\n        {\n          arrayStride: 0,\n          attributes: [],\n        },\n      ],\n    };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    //  One null buffer followed by a buffer is OK\n    const vertexState: GPUVertexStateDescriptor = {\n      vertexBuffers: [\n        {\n          arrayStride: 0,\n          attributes: [],\n        },\n        {\n          arrayStride: 0,\n          attributes: [\n            {\n              format: 'float',\n              offset: 0,\n              shaderLocation: 0,\n            },\n          ],\n        },\n      ],\n    };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    //  One null buffer sitting between buffers is OK\n    const vertexState: GPUVertexStateDescriptor = {\n      vertexBuffers: [\n        {\n          arrayStride: 0,\n          attributes: [\n            {\n              format: 'float',\n              offset: 0,\n              shaderLocation: 0,\n            },\n          ],\n        },\n        {\n          arrayStride: 0,\n          attributes: [],\n        },\n        {\n          arrayStride: 0,\n          attributes: [\n            {\n              format: 'float',\n              offset: 0,\n              shaderLocation: 1,\n            },\n          ],\n        },\n      ],\n    };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n});\n\ng.test('pipeline vertex buffers are backed by attributes in vertex input', async t => {\n  const vertexState: GPUVertexStateDescriptor = {\n    vertexBuffers: [\n      {\n        arrayStride: 2 * SIZEOF_FLOAT,\n        attributes: [\n          {\n            format: 'float',\n            offset: 0,\n            shaderLocation: 0,\n          },\n          {\n            format: 'float',\n            offset: 0,\n            shaderLocation: 1,\n          },\n        ],\n      },\n    ],\n  };\n  {\n    // Control case: pipeline with one input per attribute\n    const code = `\n      #version 450\n      layout(location = 0) in vec4 a;\n      layout(location = 1) in vec4 b;\n      void main() {\n          gl_Position = vec4(0.0);\n      }\n    `;\n    const descriptor = t.getDescriptor(vertexState, code);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Check it is valid for the pipeline to use a subset of the VertexState\n    const code = `\n      #version 450\n      layout(location = 0) in vec4 a;\n      void main() {\n          gl_Position = vec4(0.0);\n      }\n    `;\n    const descriptor = t.getDescriptor(vertexState, code);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Check for an error when the pipeline uses an attribute not in the vertex input\n    const code = `\n      #version 450\n      layout(location = 2) in vec4 a;\n      void main() {\n          gl_Position = vec4(0.0);\n      }\n    `;\n    const descriptor = t.getDescriptor(vertexState, code);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('an arrayStride of 0 is valid', t => {\n  const vertexState = {\n    vertexBuffers: [\n      {\n        arrayStride: 0,\n        attributes: [\n          {\n            format: C.VertexFormat.Float,\n            offset: 0,\n            shaderLocation: 0,\n          },\n        ],\n      },\n    ],\n  };\n  {\n    // Works ok without attributes\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Works ok with attributes at a large-ish offset\n    vertexState.vertexBuffers[0].attributes[0].offset = 128;\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n});\n\ng.test('offset should be within vertex buffer arrayStride if arrayStride is not zero', async t => {\n  const vertexState = {\n    vertexBuffers: [\n      {\n        arrayStride: 2 * SIZEOF_FLOAT,\n        attributes: [\n          {\n            format: C.VertexFormat.Float,\n            offset: 0,\n            shaderLocation: 0,\n          },\n          {\n            format: C.VertexFormat.Float,\n            offset: SIZEOF_FLOAT,\n            shaderLocation: 1,\n          },\n        ],\n      },\n    ],\n  };\n  {\n    // Control case, setting correct arrayStride and offset\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test vertex attribute offset exceed vertex buffer arrayStride range\n    const badVertexState = clone(vertexState);\n    badVertexState.vertexBuffers[0].attributes[1].format = C.VertexFormat.Float2;\n    const descriptor = t.getDescriptor(badVertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n  {\n    // Test vertex attribute offset exceed vertex buffer arrayStride range\n    const badVertexState = clone(vertexState);\n    badVertexState.vertexBuffers[0].arrayStride = SIZEOF_FLOAT;\n    const descriptor = t.getDescriptor(badVertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n  {\n    // It's OK if arrayStride is zero\n    const goodVertexState = clone(vertexState);\n    goodVertexState.vertexBuffers[0].arrayStride = 0;\n    const descriptor = t.getDescriptor(goodVertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n});\n\ng.test('check two attributes overlapping', async t => {\n  const vertexState = {\n    vertexBuffers: [\n      {\n        arrayStride: 2 * SIZEOF_FLOAT,\n        attributes: [\n          {\n            format: C.VertexFormat.Float,\n            offset: 0,\n            shaderLocation: 0,\n          },\n          {\n            format: C.VertexFormat.Float,\n            offset: SIZEOF_FLOAT,\n            shaderLocation: 1,\n          },\n        ],\n      },\n    ],\n  };\n  {\n    // Control case, setting correct arrayStride and offset\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test two attributes overlapping\n    const badVertexState = clone(vertexState);\n    badVertexState.vertexBuffers[0].attributes[0].format = C.VertexFormat.Int2;\n    const descriptor = t.getDescriptor(badVertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check out of bounds condition on total number of vertex buffers', async t => {\n  const vertexBuffers: GPUVertexBufferLayoutDescriptor[] = [];\n\n  for (let i = 0; i < MAX_VERTEX_BUFFERS; i++) {\n    vertexBuffers.push({\n      arrayStride: 0,\n      attributes: [\n        {\n          format: 'float',\n          offset: 0,\n          shaderLocation: i,\n        },\n      ],\n    });\n  }\n  {\n    // Control case, setting max vertex buffer number\n    const vertexState: GPUVertexStateDescriptor = { vertexBuffers };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test vertex buffer number exceed the limit\n    const vertexState: GPUVertexStateDescriptor = {\n      vertexBuffers: [\n        ...vertexBuffers,\n        {\n          arrayStride: 0,\n          attributes: [\n            {\n              format: 'float',\n              offset: 0,\n              shaderLocation: MAX_VERTEX_BUFFERS,\n            },\n          ],\n        },\n      ],\n    };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check out of bounds on number of vertex attributes on a single vertex buffer', async t => {\n  const vertexAttributes: GPUVertexAttributeDescriptor[] = [];\n\n  for (let i = 0; i < MAX_VERTEX_ATTRIBUTES; i++) {\n    vertexAttributes.push({\n      format: 'float',\n      offset: 0,\n      shaderLocation: i,\n    });\n  }\n  {\n    // Control case, setting max vertex buffer number\n    const vertexState: GPUVertexStateDescriptor = {\n      vertexBuffers: [\n        {\n          arrayStride: 0,\n          attributes: vertexAttributes,\n        },\n      ],\n    };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test vertex attribute number exceed the limit\n    const vertexState: GPUVertexStateDescriptor = {\n      vertexBuffers: [\n        {\n          arrayStride: 0,\n          attributes: [\n            ...vertexAttributes,\n            {\n              format: 'float',\n              offset: 0,\n              shaderLocation: MAX_VERTEX_ATTRIBUTES,\n            },\n          ],\n        },\n      ],\n    };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check out of bounds on number of vertex attributes across vertex buffers', async t => {\n  const vertexBuffers: GPUVertexBufferLayoutDescriptor[] = [];\n  for (let i = 0; i < MAX_VERTEX_ATTRIBUTES; i++) {\n    vertexBuffers.push({\n      arrayStride: 0,\n      attributes: [{ format: 'float', offset: 0, shaderLocation: i }],\n    });\n  }\n\n  {\n    // Control case, setting max vertex buffer number\n    const vertexState: GPUVertexStateDescriptor = { vertexBuffers };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test vertex attribute number exceed the limit\n    vertexBuffers[MAX_VERTEX_ATTRIBUTES - 1].attributes.push({\n      format: 'float',\n      offset: 0,\n      shaderLocation: MAX_VERTEX_ATTRIBUTES,\n    });\n    const vertexState: GPUVertexStateDescriptor = { vertexBuffers };\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check out of bounds condition on input strides', async t => {\n  const vertexState = {\n    vertexBuffers: [{ arrayStride: MAX_VERTEX_BUFFER_ARRAY_STRIDE, attributes: [] }],\n  };\n  {\n    // Control case, setting max input arrayStride\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test input arrayStride OOB\n    vertexState.vertexBuffers[0].arrayStride = MAX_VERTEX_BUFFER_ARRAY_STRIDE + 4;\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check multiple of 4 bytes constraint on input arrayStride', async t => {\n  const vertexState = {\n    vertexBuffers: [\n      {\n        arrayStride: 4,\n        attributes: [{ format: C.VertexFormat.Uchar2, offset: 0, shaderLocation: 0 }],\n      },\n    ],\n  };\n  {\n    // Control case, setting input arrayStride 4 bytes\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test input arrayStride not multiple of 4 bytes\n    vertexState.vertexBuffers[0].arrayStride = 2;\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('identical duplicate attributes are invalid', async t => {\n  const vertexState = {\n    vertexBuffers: [\n      {\n        arrayStride: 0,\n        attributes: [{ format: C.VertexFormat.Float, offset: 0, shaderLocation: 0 }],\n      },\n    ],\n  };\n  {\n    // Control case, setting attribute 0\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Oh no, attribute 0 is set twice\n    vertexState.vertexBuffers[0].attributes.push({\n      format: C.VertexFormat.Float,\n      offset: 0,\n      shaderLocation: 0,\n    });\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('we cannot set same shader location', async t => {\n  {\n    const vertexState = {\n      vertexBuffers: [\n        {\n          arrayStride: 0,\n          attributes: [\n            { format: C.VertexFormat.Float, offset: 0, shaderLocation: 0 },\n            { format: C.VertexFormat.Float, offset: SIZEOF_FLOAT, shaderLocation: 1 },\n          ],\n        },\n      ],\n    };\n    {\n      // Control case, setting different shader locations in two attributes\n      const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n      t.device.createRenderPipeline(descriptor);\n    }\n    {\n      // Test same shader location in two attributes in the same buffer\n      vertexState.vertexBuffers[0].attributes[1].shaderLocation = 0;\n      const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n      t.expectValidationError(() => {\n        t.device.createRenderPipeline(descriptor);\n      });\n    }\n  }\n  {\n    const vertexState: GPUVertexStateDescriptor = {\n      vertexBuffers: [\n        {\n          arrayStride: 0,\n          attributes: [\n            {\n              format: 'float',\n              offset: 0,\n              shaderLocation: 0,\n            },\n          ],\n        },\n        {\n          arrayStride: 0,\n          attributes: [\n            {\n              format: 'float',\n              offset: 0,\n              shaderLocation: 0,\n            },\n          ],\n        },\n      ],\n    };\n    // Test same shader location in two attributes in different buffers\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check out of bounds condition on attribute shader location', async t => {\n  const vertexState = {\n    vertexBuffers: [\n      {\n        arrayStride: 0,\n        attributes: [\n          { format: C.VertexFormat.Float, offset: 0, shaderLocation: MAX_VERTEX_ATTRIBUTES - 1 },\n        ],\n      },\n    ],\n  };\n  {\n    // Control case, setting last attribute shader location\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test attribute location OOB\n    vertexState.vertexBuffers[0].attributes[0].shaderLocation = MAX_VERTEX_ATTRIBUTES;\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check attribute offset out of bounds', async t => {\n  const vertexState = {\n    vertexBuffers: [\n      {\n        arrayStride: 0,\n        attributes: [\n          {\n            format: C.VertexFormat.Float2,\n            offset: MAX_VERTEX_BUFFER_END - 2 * SIZEOF_FLOAT,\n            shaderLocation: 0,\n          },\n        ],\n      },\n    ],\n  };\n  {\n    // Control case, setting max attribute offset to MAX_VERTEX_BUFFER_END - 8\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Control case, setting attribute offset to 8\n    vertexState.vertexBuffers[0].attributes[0].offset = 8;\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test attribute offset out of bounds\n    vertexState.vertexBuffers[0].attributes[0].offset = MAX_VERTEX_BUFFER_END - 4;\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check multiple of 4 bytes constraint on offset', async t => {\n  const vertexState = {\n    vertexBuffers: [\n      {\n        arrayStride: 0,\n        attributes: [{ format: C.VertexFormat.Float, offset: SIZEOF_FLOAT, shaderLocation: 0 }],\n      },\n    ],\n  };\n  {\n    // Control case, setting offset 4 bytes\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.device.createRenderPipeline(descriptor);\n  }\n  {\n    // Test offset of 2 bytes with uchar2 format\n    vertexState.vertexBuffers[0].attributes[0].offset = 2;\n    vertexState.vertexBuffers[0].attributes[0].format = C.VertexFormat.Uchar2;\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n  {\n    // Test offset of 2 bytes with float format\n    vertexState.vertexBuffers[0].attributes[0].offset = 2;\n    vertexState.vertexBuffers[0].attributes[0].format = C.VertexFormat.Float;\n    const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n    t.expectValidationError(() => {\n      t.device.createRenderPipeline(descriptor);\n    });\n  }\n});\n\ng.test('check attribute offset overflow', async t => {\n  const vertexState: GPUVertexStateDescriptor = {\n    vertexBuffers: [\n      {\n        arrayStride: 0,\n        attributes: [{ format: 'float', offset: Number.MAX_SAFE_INTEGER, shaderLocation: 0 }],\n      },\n    ],\n  };\n  const descriptor = t.getDescriptor(vertexState, VERTEX_SHADER_CODE_WITH_NO_INPUT);\n\n  t.expectValidationError(() => {\n    t.device.createRenderPipeline(descriptor);\n  });\n});\n"],"file":"vertex_state.spec.js"}
{"version":3,"sources":["../../../src/suites/unittests/getStackTrace.spec.ts"],"names":["description","TestGroup","getStackTrace","UnitTest","g","test","t","lines","params","_expectedLines","ex","Error","stack","_stack","expect","stringified","parts","split","length","fst","lst","indexOf","case"],"mappings":"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","sourcesContent":["export const description = `\nTests for getStackTrace.\n`;\n\nimport { TestGroup, getStackTrace } from '../../framework/index.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = new TestGroup(UnitTest);\n\ng.test('stacks', t => {\n  const lines: number = t.params._expectedLines;\n\n  const ex = new Error();\n  ex.stack = t.params._stack;\n  t.expect(ex.stack === t.params._stack);\n  const stringified = getStackTrace(ex);\n  const parts = stringified.split('\\n');\n\n  t.expect(parts.length === lines);\n  const fst = parts[0];\n  const lst = parts[parts.length - 1];\n  t.expect(fst.indexOf('/suites/') !== -1 || fst.indexOf('\\\\suites\\\\') !== -1);\n  t.expect(lst.indexOf('/suites/') !== -1 || lst.indexOf('\\\\suites\\\\') !== -1);\n}).params([\n  {\n    case: 'node_fail',\n    _expectedLines: 1,\n    _stack: `Error:\n   at CaseRecorder.fail (/Users/kainino/src/cts-experiment/src/framework/logger.ts:99:30)\n   at RunCaseSpecific.exports.g.test.t [as fn] (/Users/kainino/src/cts-experiment/src/suites/unittests/logger.spec.ts:80:7)\n   at RunCaseSpecific.run (/Users/kainino/src/cts-experiment/src/framework/test_group.ts:121:18)\n   at processTicksAndRejections (internal/process/task_queues.js:86:5)`,\n  },\n  {\n    // TODO: make sure this test case actually matches what happens on windows\n    case: 'node_fail_backslash',\n    _expectedLines: 1,\n    _stack: `Error:\n   at CaseRecorder.fail (C:\\\\Users\\\\kainino\\\\src\\\\cts-experiment\\\\src\\\\framework\\\\logger.ts:99:30)\n   at RunCaseSpecific.exports.g.test.t [as fn] (C:\\\\Users\\\\kainino\\\\src\\\\cts-experiment\\\\src\\\\suites\\\\unittests\\\\logger.spec.ts:80:7)\n   at RunCaseSpecific.run (C:\\\\Users\\\\kainino\\\\src\\\\cts-experiment\\\\src\\\\framework\\\\test_group.ts:121:18)\n   at processTicksAndRejections (internal\\\\process\\\\task_queues.js:86:5)`,\n  },\n  {\n    case: 'node_fail_processTicksAndRejections',\n    _expectedLines: 3,\n    _stack: `Error: expectation had no effect: suite1:foo:\n    at Object.generateMinimalQueryList (/Users/kainino/src/cts/src/framework/generate_minimal_query_list.ts:72:24)\n    at testGenerateMinimalQueryList (/Users/kainino/src/cts/src/suites/unittests/loading.spec.ts:289:25)\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\n    at RunCaseSpecific.fn (/Users/kainino/src/cts/src/suites/unittests/loading.spec.ts:300:3)\n    at RunCaseSpecific.run (/Users/kainino/src/cts/src/framework/test_group.ts:144:9)\n    at /Users/kainino/src/cts/src/runtime/cmdline.ts:62:25\n    at async Promise.all (index 29)\n    at /Users/kainino/src/cts/src/runtime/cmdline.ts:78:5`,\n  },\n  {\n    case: 'node_throw',\n    _expectedLines: 1,\n    _stack: `Error: hello\n    at RunCaseSpecific.g.test.t [as fn] (/Users/kainino/src/cts-experiment/src/suites/unittests/test_group.spec.ts:51:11)\n    at RunCaseSpecific.run (/Users/kainino/src/cts-experiment/src/framework/test_group.ts:121:18)\n    at processTicksAndRejections (internal/process/task_queues.js:86:5)`,\n  },\n  {\n    case: 'firefox_fail',\n    _expectedLines: 1,\n    _stack: `fail@http://localhost:8080/out/framework/logger.js:104:30\nexpect@http://localhost:8080/out/framework/default_fixture.js:59:16\n@http://localhost:8080/out/suites/unittests/util.spec.js:35:5\nrun@http://localhost:8080/out/framework/test_group.js:119:18`,\n  },\n  {\n    case: 'firefox_throw',\n    _expectedLines: 1,\n    _stack: `@http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11\nrun@http://localhost:8080/out/framework/test_group.js:119:18`,\n  },\n  {\n    case: 'safari_fail',\n    _expectedLines: 1,\n    _stack: `fail@http://localhost:8080/out/framework/logger.js:104:39\nexpect@http://localhost:8080/out/framework/default_fixture.js:59:20\nhttp://localhost:8080/out/suites/unittests/util.spec.js:35:11\nhttp://localhost:8080/out/framework/test_group.js:119:20\nasyncFunctionResume@[native code]\n[native code]\npromiseReactionJob@[native code]`,\n  },\n  {\n    case: 'safari_throw',\n    _expectedLines: 1,\n    _stack: `http://localhost:8080/out/suites/unittests/test_group.spec.js:48:20\nhttp://localhost:8080/out/framework/test_group.js:119:20\nasyncFunctionResume@[native code]\n[native code]\npromiseReactionJob@[native code]`,\n  },\n  {\n    case: 'chrome_fail',\n    _expectedLines: 1,\n    _stack: `Error\n    at CaseRecorder.fail (http://localhost:8080/out/framework/logger.js:104:30)\n    at DefaultFixture.expect (http://localhost:8080/out/framework/default_fixture.js:59:16)\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/util.spec.js:35:5)\n    at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\n    at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/runtime/standalone.js:102:7`,\n  },\n  {\n    case: 'chrome_throw',\n    _expectedLines: 5,\n    _stack: `Error: hello\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\"\n    at async Promise.all (index 0)\n    at async TestGroupTest.run (http://localhost:8080/out/suites/unittests/test_group_test.js:6:5)\n    at async RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:53:15)\n    at async RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:7)\n    at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/runtime/standalone.js:102:7`,\n  },\n  {\n    case: 'multiple_lines',\n    _expectedLines: 7,\n    _stack: `Error: hello\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\"\n    at async Promise.all (index 0)\n    at async TestGroupTest.run (http://localhost:8080/out/suites/unittests/test_group_test.js:6:5)\n    at async RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:53:15)\n    at async RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:7)\n    at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/runtime/standalone.js:102:7`,\n  },\n]);\n"],"file":"getStackTrace.spec.js"}